import boto3

def lambda_handler(event, context):
    ec2 = boto3.client('ec2')
    instance_id = event['instance_id']
    tag_key_to_replace = event['tag_key_to_replace']
    new_tag_value = event['new_tag_value']

    # Describe the EC2 instance to get its current tags
    response = ec2.describe_instances(InstanceIds=[instance_id])
    instance = response['Reservations'][0]['Instances'][0]
    current_tags = instance.get('Tags', [])

    # Find the tag with the specified key and replace its value
    updated_tags = []
    for tag in current_tags:
        if tag['Key'] == tag_key_to_replace:
            tag['Value'] = new_tag_value
        updated_tags.append(tag)

    # Update the instance's tags with the modified list
    ec2.create_tags(
        Resources=[instance_id],
        Tags=updated_tags
    )

    return {
        'statusCode': 200,
        'body': f"Tag '{tag_key_to_replace}' updated to '{new_tag_value}' on instance '{instance_id}'."
    }
